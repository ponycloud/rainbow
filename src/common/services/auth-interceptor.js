// Generated by CoffeeScript 1.6.3
(function() {
  var factoryFunction, module;

  module = angular.module('rainbowServices');

  factoryFunction = function(auth, $q) {
    return {
      'request': function(config) {
        var configPromise, tenantSearch, tenantUrl, token;
        tenantSearch = /\/tenant\/([0-9a-z-]*)\//;
        tenantUrl = tenantSearch.exec(config.url);
        configPromise = $q.defer();
        if ((config['headers']['Authorization'] != null) || config.url.indexOf('/api/') === -1) {
          return config;
        }
        if (tenantUrl) {
          token = auth.getTenantToken(tenantUrl[1]);
        } else {
          token = auth.getUserToken();
        }
        token.then(function(tokenValue) {
          if (tokenValue != null) {
            config['headers'] = angular.extend(config['headers'] || {}, {
              'Authorization': 'Token ' + tokenValue
            });
          }
          return configPromise.resolve(config);
        });
        return configPromise.promise;
      }
    };
  };

  module.factory('authInterceptor', factoryFunction);

  module.config([
    '$httpProvider', function($httpProvider) {
      return $httpProvider.interceptors.push('authInterceptor');
    }
  ]);

}).call(this);
